<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xem Phim Online - Danh Sách</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #14110b;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #fff;
        }

        h1 {
            text-align: center;
            font-size: 2em;
            margin-bottom: 20px;
            color: #f5cf8e;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        h2 {
            font-size: 1.5em;
            color: #af762f;
            margin: 20px 0 10px;
            text-align: center;
            background: linear-gradient(90deg, #af762f, #f5cf8e);
            padding: 8px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .search-bar {
            text-align: center;
            margin-bottom: 20px;
        }

        .search-input {
            padding: 10px;
            width: 300px;
            font-size: 1em;
            border: 2px solid #af762f;
            border-radius: 5px;
            background: #af762f;
            color: black;
        }

        .search-input::placeholder {
            color: black;
        }

        .category-menu {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .category-link {
            color: #af762f;
            text-decoration: none;
            font-size: 1.2em;
            padding: 8px 16px;
            border: 2px solid #af762f;
            border-radius: 5px;
            transition: background 0.3s ease, color 0.3s ease;
        }

        .category-link:hover {
            background: #f5cf8e;
            color: black;
        }

        .movie-section {
            margin-bottom: 20px;
        }

        .movie-container {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            max-width: 1600px;
            margin: 0 auto;
            justify-content: space-between;
        }

        .movie-card {
            flex: 0 0 160px;
            text-decoration: none;
            color: inherit;
            transition: transform 0.3s ease;
            position: relative;
        }

        .movie-poster {
            width: 100%;
            height: auto;
            max-height: 270px;
            border: 2px solid #af762f;
            border-radius: 8px;
            display: block;
            transition: transform 0.3s ease;
        }

        .movie-title {
            padding: 8px 0;
            font-size: 1em;
            font-weight: bold;
            text-align: center;
            color: #af762f;
        }

        .source-label {
            position: absolute;
            top: 5px;
            right: 5px;
            padding: 2px 5px;
            font-size: 0.8em;
            color: #fff;
            border-radius: 3px;
        }

        .source-api {
            background: #af762f;
        }

        .source-creator {
            background: black;
        }

        .movie-card:hover {
            transform: scale(1.05);
        }

        @media (max-width: 600px) {
            .movie-container {
                max-width: 340px;
                justify-content: space-between;
            }

            .movie-card {
                flex: 0 0 150px;
            }

            .movie-poster {
                max-height: 225px;
            }

            .category-menu {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }

            .search-input {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <h1>Bánh mì là số 1</h1>
    <div class="search-bar">
        <input type="text" class="search-input" id="searchInput" placeholder="Tìm kiếm phim...">
    </div>
    <div class="category-menu">
        <a href="phim-my.html" class="category-link">Phim Mỹ</a>
        <a href="phim-viet.html" class="category-link">Phim Việt</a>
        <a href="phim-han.html" class="category-link">Phim Hàn</a>
    </div>
    <div class="movie-section">
        <h2>Xưởng Bánh Mì</h2>
        <div class="movie-container" id="creatorContainer"></div>
    </div>
    <div class="movie-section">
        <h2>Trung Quốc</h2>
        <div class="movie-container" id="apiContainer"></div>
    </div>

    <script>
        // Danh sách API phim với proxy CORS
        const apiUrls = [
            'https://phimapi.com/phim/man-thanh',
            'https://ophim1.com/phim/yeu-em',
            'https://ophim1.com/phim/vu-ai-thien-kim',
            'https://ophim1.com/phim/cay-o-liu-mau-trang',
            'https://ophim1.com/phim/chiec-bat-lua-va-vay-cong-chua',
            'https://ophim1.com/phim/hoa-gian-nhat-khuynh-thanh',
            'https://ophim1.com/phim/lu-kinh',
            'https://ophim1.com/phim/rang-buoc-toi-loi',
            'https://ophim1.com/phim/mot-ngay-trai-chu-mot-ngay-quan',
            'https://ophim1.com/phim/chiem-huu-khuong-tay',
            'https://ophim1.com/phim/my-nhan-tro-ve',
            'https://ophim1.com/phim/duoi-tan-cay-co-ngoi-nha-mai-do',
            'https://ophim1.com/phim/sao-dich-noi-sac-dep-tuyet-tran',
            'https://ophim1.com/phim/tien-dai-co-cay',
            'https://ophim1.com/phim/quoc-sac-phuong-hoa',
            'https://ophim1.com/phim/kho-do-danh',
            'https://ophim1.com/phim/tu-hai-trong-minh',
            'https://ophim1.com/phim/truong-nguyet-tan-minh',
            'https://ophim1.com/phim/ca-muc-ham-mat',
            'https://ophim1.com/phim/van-chi-vu',
            'https://phimapi.com/phim/bay-kiep-may-man',
            'https://phimapi.com/phim/thieu-nien-ca-hanh',
            'https://phimapi.com/phim/ky-kim-trieu',
            'https://ophim1.com/phim/luu-ly-my-nhan-sat',
            'https://ophim1.com/phim/du-sinh-xin-chi-giao-nhieu-hon-quang-doi-con-lai-xin-chi-giao-nhieu-hon',
            'https://ophim1.com/phim/thuong-lan-quyet',
            'https://ophim1.com/phim/lien-hoa-lau',
            'https://ophim1.com/phim/thieu-nien-bach-ma-tuy-xuan-phong',
            'https://ophim1.com/phim/khuc-bien-tau-anh-trang',
            'https://ophim1.com/phim/ho-tam',
            'https://ophim1.com/phim/bi-mat-noi-goc-toi',
            'https://ophim1.com/phim/di-ai-vi-doanh',
            'https://ophim1.com/phim/ngu-phuc-lam-mon',
            'https://ophim1.com/phim/vinh-da-tinh-ha',
            'https://ophim1.com/phim/dai-mong-quy-ly',
            'https://ophim1.com/phim/nua-la-duong-mat-nua-dau-thuong',
            'https://ophim1.com/phim/vung-trom-khong-the-giau',
            'https://ophim1.com/phim/du-phuong-hanh',
            'https://ophim1.com/phim/than-an',
            'https://ophim1.com/phim/bach-nguyet-phan-tinh',
            'https://ophim1.com/phim/ninh-an-nhu-mong',
            'https://ophim1.com/phim/truong-lac-khuc',
            'https://phimapi.com/phim/dien-canh-ky',
            'https://phimapi.com/phim/doi-voi-toi-anh-ay-la-nguoi-nguy-hiem',
            'https://ophim1.com/phim/toi-mong-giua-ban-ngay',
            'https://phimapi.com/phim/khanh-khanh-tam-tu',
            'https://ophim1.com/phim/thien-ho-dai-nhan-than-men',
            'https://ophim1.com/phim/cam-bay-ngot-ngao',
            'https://ophim1.com/phim/tam-thien-nha-sat',
            'https://ophim1.com/phim/phong-nguyet-nhu-tuyet',
            'https://ophim1.com/phim/anh-cung-co-ngay-nay',
            'https://ophim1.com/phim/yeu-em-tu-cai-nhin-dau-tien-2016',
            'https://ophim1.com/phim/hay-yeu-nhau-duoi-anh-trang-tron',
            'https://ophim1.com/phim/huong-mat-tua-khoi-suong',
            'https://ophim1.com/phim/len-nham-kieu-hoa-duoc-chong-nhu-y',
            'https://ophim1.com/phim/chung-ta-dang-yeu-nhu-the',
            'https://ophim1.com/phim/chi-la-quan-he-hon-nhan',
            'https://ophim1.com/phim/tinh-yeu-anh-danh-cho-em',
            'https://ophim1.com/phim/thoi-gian-va-anh-vua-hay-dung-luc',
            'https://ophim1.com/phim/khi-anh-chay-ve-phia-em',
            'https://ophim1.com/phim/hau-lang',
            'https://ophim1.com/phim/gap-lai-tieu-dao',
            'https://ophim1.com/phim/toi-da-gap-duoc-vi-cuu-tinh',
            'https://ophim1.com/phim/khu-rung-nho-cua-hai-nguoi',
            'https://phimapi.com/phim/hoa-gian-nhat-khuynh-thanh',
         
         


        ];

        // URL raw của series.txt từ GitHub
        const seriesTxtUrl = 'https://raw.githubusercontent.com/ngocnguyenmd/ngocnguyenmd/refs/heads/main/series.txt';

        // Tùy chỉnh tên nhãn nguồn
        const sourceLabels = {
            api: 'Vip',
            creator: 'HD+'
        };

        // Fetch dữ liệu từ API
        const fetchAPIs = apiUrls.map(url => 
            fetch(url)
                .then(response => response.json())
                .catch(err => {
                    console.error(`Lỗi khi gọi API ${url}:`, err);
                    return null;
                })
        );

        // Fetch dữ liệu từ series.txt
        const fetchTxt = fetch(seriesTxtUrl)
            .then(response => response.text())
            .catch(err => {
                console.error('Lỗi khi tải series.txt:', err);
                return '';
            });

        let allMovies = {};

        // Gộp dữ liệu từ cả API và txt
        Promise.all([...fetchAPIs, fetchTxt])
            .then(results => {
                const creatorContainer = document.getElementById('creatorContainer');
                const apiContainer = document.getElementById('apiContainer');
                allMovies = {};

                // Xử lý dữ liệu từ API
                results.slice(0, -1).forEach(data => {
                    if (!data || !data.status || !data.movie) return;
                    const movie = data.movie;
                    const title = movie.name;
                    const poster = movie.poster_url;
                    const seriesId = movie.slug;
                    const episodes = data.episodes[0].server_data.map(ep => ({
                        title: `Tập ${ep.name}`,
                        url: ep.link_m3u8
                    }));

                    allMovies[seriesId] = { title, poster, episodes, source: 'api' };
                });

                // Xử lý dữ liệu từ series.txt
                const txtData = results[results.length - 1];
                if (txtData) {
                    const lines = txtData.split('\n');
                    lines.forEach(line => {
                        if (line.trim() && !line.startsWith('#')) {
                            const [title, episodeTitle, url] = line.split('|');
                            const seriesId = title.toLowerCase().replace(/\s+/g, '-');
                            if (!allMovies[seriesId]) {
                                allMovies[seriesId] = { title, poster: '', episodes: [], source: 'creator' };
                            }
                            if (!episodeTitle && url) {
                                allMovies[seriesId].poster = url;
                            } else if (url) {
                                allMovies[seriesId].episodes.push({ title: episodeTitle, url });
                            }
                        }
                    });
                }

                // Hàm hiển thị phim
                function displayMovies(filter = '') {
                    creatorContainer.innerHTML = '';
                    apiContainer.innerHTML = '';
                    Object.keys(allMovies).forEach(seriesId => {
                        const { title, poster, episodes, source } = allMovies[seriesId];
                        // Chỉ hiển thị phim nếu có poster hợp lệ
                        if (poster && title.toLowerCase().includes(filter.toLowerCase())) {
                            const card = document.createElement('a');
                            card.href = `series.html?id=${seriesId}`;
                            card.className = 'movie-card';
                            card.innerHTML = `
                                <img src="${poster}" class="movie-poster" alt="${title}">
                                <div class="movie-title">${title}</div>
                                <span class="source-label source-${source}">${sourceLabels[source]}</span>
                            `;
                            if (source === 'creator') {
                                creatorContainer.appendChild(card);
                            } else if (source === 'api') {
                                apiContainer.appendChild(card);
                            }

                            localStorage.setItem(seriesId, JSON.stringify({
                                title,
                                poster,
                                episodes,
                                source
                            }));
                        }
                    });

                    // Thông báo nếu không có phim
                    if (creatorContainer.children.length === 0) {
                        creatorContainer.innerHTML = '<p style="color: #af762f; text-align: center;">Chưa có phim từ Xưởng Bánh Mì</p>';
                    }
                    if (apiContainer.children.length === 0) {
                        apiContainer.innerHTML = '<p style="color: #af762f; text-align: center;">Chưa có phim từ Trung Quốc</p>';
                    }
                }

                // Hiển thị ban đầu
                displayMovies();

                // Xử lý tìm kiếm
                const searchInput = document.getElementById('searchInput');
                searchInput.addEventListener('input', (e) => {
                    displayMovies(e.target.value);
                });
            })
            .catch(error => console.error('Lỗi khi tải dữ liệu:', error));
    </script>
</body>
</html>
