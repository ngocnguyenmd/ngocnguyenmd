<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thông Tin Phim</title>
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #14110b;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #fff;
            line-height: 1.6;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 20px auto;
        }

        h1 {
            text-align: center;
            color: #f5cf8e;
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .movie-info {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            align-items: flex-start;
        }

        .poster {
            width: 100%;
            max-width: 300px;
            height: auto;
            border-radius: 8px;
            border: 3px solid #af762f;
            object-fit: cover;
        }

        .details {
            flex: 1;
            max-width: 600px;
            margin-top: 10px;
            text-align: center;
        }

        .details h2 {
            color: #f5cf8e;
            font-size: 1.8em;
            margin-bottom: 15px;
        }

        .details p {
            font-size: 1.1em;
            color: #bbb;
            line-height: 1.8;
        }

        .watch-button {
            background-color: #af762f;
            color: white;
            font-size: 1em; /* Giảm kích thước nút xem phim */
            padding: 8px 16px;
            border-radius: 5px;
            margin-top: 20px;
            cursor: pointer;
            text-align: center;
            width: 100%;
            transition: background-color 0.3s;
        }

        .watch-button:hover {
            background-color: #f5cf8e;
        }

        .episodes {
            margin-top: 40px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .episode {
            width: 60px;
            height: 60px;
            background-color: #222;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
            font-size: 1em;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            text-align: center;
        }

        .episode:hover {
            background: #af762f;
            transform: scale(1.1);
        }

        .episode.active {
            background: #af762f;
            transform: scale(1.1);
            border: 2px solid #fff;
        }

        #playerContainer {
            margin-top: 30px;
            display: none;
            text-align: center;
        }

        #playerContainer h2 {
            color: #f5cf8e;
            font-size: 1.5em;
            margin-bottom: 15px;
        }

        #player {
            width: 100%;
            max-width: 100%;
            height: auto;
            border-radius: 8px;
        }

        .loading {
            text-align: center;
            font-size: 1.5em;
            color: #f5cf8e;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 2em;
        }

        .btn-skip {
            background: #f5cf8e;
            padding: 10px 20px;
            font-size: 1.2em;
            cursor: pointer;
            border: none;
            margin-top: 20px;
            border-radius: 5px;
            transition: background 0.3s ease;
        }

        .btn-skip:hover {
            background: #af762f;
        }

        /* Nút quay lại trang chủ */
        .back-to-home {
            background-color: #f5cf8e;
            color: white;
            font-size: 1.2em;
            padding: 8px 16px; /* Giảm kích thước nút quay lại */
            border-radius: 5px;
            width: 100%;
            text-align: center;
            cursor: pointer;
            margin-top: 30px;
            transition: background-color 0.3s;
        }

        .back-to-home:hover {
            background-color: #af762f;
        }

        /* Các nút điều khiển video */
        .control-buttons {
            display: flex;
            justify-content: center; /* Căn giữa các nút theo chiều ngang */
            align-items: center; /* Căn giữa các nút theo chiều dọc */
            margin-top: 15px;
            gap: 15px; /* Khoảng cách giữa các nút */
        }

        .control-btn {
            background-color: #222;
            color: #fff;
            font-size: 1.5em; /* Giảm kích thước các nút điều khiển */
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:hover {
            background-color: #af762f;
        }

        /* Mô tả nằm dưới cùng */
        .description-container {
            display: flex;
            flex-direction: column;
            margin-top: 20px;
        }

        .description-container p {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.2em;
        }
    </style>
</head>
<body>

<div class="container">
    <h1 id="movieTitle">Loading...</h1>
    <div class="movie-info">
        <img id="moviePoster" class="poster" src="" alt="Poster of Movie">
        <div class="details">
            <button class="watch-button" onclick="playFirstEpisode()">Xem Phim</button>
        </div>
    </div>

    <div id="playerContainer">
        <h2>Đang xem: <span id="currentEpisode"></span></h2>
        <video id="player" controls>
            <source id="videoSource" src="" type="application/x-mpegURL">
        </video>

        <!-- Các nút điều khiển video -->
        <div class="control-buttons">
            <button class="control-btn" onclick="rewind()">⏪︎</button>
            <button class="control-btn" onclick="playNextEpisode(false)">⏮︎</button>
            <button class="control-btn" onclick="playNextEpisode(true)">⏭</button>
            <button class="control-btn" onclick="fastForward()">⏩︎</button>
        </div>
    </div>

    <div class="episodes" id="episodeList"></div>

    <!-- Mô tả phim nằm dưới danh sách tập -->
    <div class="description-container">
        <h2>Mô tả phim</h2>
        <div id="movieDescriptionContainer">
            <p id="movieDescription">Mô tả phim sẽ được hiển thị ở đây...</p>
        </div>
        <div class="back-to-home" onclick="window.location.href='index.html'">Quay lại trang chủ</div>
    </div>

    <div id="overlay" class="overlay">
        <div>Bạn có muốn chuyển tới tập tiếp theo?</div>
        <button class="btn-skip" onclick="skipToNext()">Chuyển tới tập tiếp theo</button>
    </div>

    <div id="loadingMessage" class="loading" style="display: none;">Đang tải dữ liệu...</div>
</div>

<script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const movieId = urlParams.get('id');
    const apiUrl = `https://ophim1.com/phim/${movieId}`;

    document.getElementById('loadingMessage').style.display = 'block';

    fetch(apiUrl)
        .then(response => response.json())
        .then(data => {
            document.getElementById('loadingMessage').style.display = 'none';

            if (!data.status) {
                document.getElementById('movieTitle').innerText = "Không tìm thấy phim.";
                return;
            }

            document.getElementById("movieTitle").innerText = data.movie.name;
            document.getElementById("moviePoster").src = data.movie.poster_url;

            // Hiển thị mô tả phim từ API nếu có
            const movieDescription = data.movie.content;
            if (movieDescription) {
                document.getElementById("movieDescription").innerText = movieDescription;
            } else {
                document.getElementById("movieDescription").innerText = "Mô tả phim chưa có.";
            }

            const episodeList = document.getElementById("episodeList");
            data.episodes[0].server_data.forEach((ep, index) => {
                let epItem = document.createElement("div");
                epItem.className = "episode";
                epItem.innerText = `Tập ${index + 1}`;
                epItem.onclick = () => playEpisode(ep.link_m3u8, `Tập ${index + 1}`, epItem);
                episodeList.appendChild(epItem);
            });
        })
        .catch(err => {
            console.error("Lỗi tải phim:", err);
            document.getElementById('loadingMessage').innerText = 'Lỗi khi tải dữ liệu.';
        });

    let currentPlayer = null;

    function playFirstEpisode() {
        const firstEpisode = document.querySelector(".episode");
        if (firstEpisode) {
            firstEpisode.click();
        }
    }

    function playEpisode(url, name, episodeElement) {
        const allEpisodes = document.querySelectorAll('.episode');
        allEpisodes.forEach(ep => ep.classList.remove('active'));

        episodeElement.classList.add('active');

        document.getElementById("playerContainer").style.display = "block";
        document.getElementById("currentEpisode").innerText = name;

        if (Hls.isSupported()) {
            const hls = new Hls();
            hls.loadSource(url);
            hls.attachMedia(document.getElementById("player"));
            hls.on(Hls.Events.MANIFEST_PARSED, function () {
                document.getElementById("player").play();
            });
        } else if (document.getElementById("player").canPlayType("application/vnd.apple.mpegurl")) {
            document.getElementById("player").src = url;
            document.getElementById("player").play();
        }

        const player = new Plyr('#player', {
            captions: { active: true, language: 'vi' }
        });
    }

    function rewind() {
        const video = document.getElementById("player");
        video.currentTime -= 10;
    }

    function fastForward() {
        const video = document.getElementById("player");
        video.currentTime += 10;
    }

    function playNextEpisode(isNext) {
        const allEpisodes = document.querySelectorAll(".episode");
        const currentIndex = Array.from(allEpisodes).findIndex(ep => ep.classList.contains('active'));

        if (isNext && currentIndex < allEpisodes.length - 1) {
            allEpisodes[currentIndex + 1].click();
        } else if (!isNext && currentIndex > 0) {
            allEpisodes[currentIndex - 1].click();
        }
    }

    function skipToNext() {
        document.getElementById('overlay').style.display = 'none';
    }
</script>

</body>
</html>
