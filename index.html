<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Phim Nh√† B√°nh M√¨</title>
  <style>
/* ===== GLOBAL ===== */
* { box-sizing: border-box; margin:0; padding:0; }
html, body { height:100%; }
body {
  font-family: Arial, Helvetica, sans-serif;
  background: #1a191f;
  color:#fff;
  overflow-x:hidden;
}

/* ===== HEADER ===== */
header {
  background:#212026;
  padding:8px 12px;
  position:sticky;
  top:0; z-index:100;
}
.Top {
  display:flex;
  align-items:center;
  justify-content:space-between;
  max-width:1200px;
  margin:0 auto;
}
.Logo {
  font-size:18px;
  font-weight:700;
  color:#fff;
}

/* MENU BTN */
.MenuBtn {
  background:none;
  border:none;
  color:#fff;
  font-size:20px;
  cursor:pointer;
  padding:6px;
  border-radius:6px;
}
.MenuBtn:active { background:rgba(255,255,255,0.12); }

.MenuDropdown {
  display:none;
  position:absolute;
  top:50px; left:12px;
  width:200px;
  background:#2b2b32;
  border-radius:8px;
  padding:8px;
  box-shadow:0 6px 16px rgba(0,0,0,.6);
}
.MenuDropdown.show { display:block; }
.MenuDropdown button {
  width:100%;
  padding:10px;
  margin:4px 0;
  border:none;
  border-radius:6px;
  background:#333;
  color:#fff;
  text-align:left;
  cursor:pointer;
}
.MenuDropdown button:hover { background:#444; }

/* SEARCH */
.Search {
    display: flex
;
    align-items: left;
    gap: 6px;
    align-content: space-between;
    justify-content: space-evenly;
    flex-wrap: nowrap;
}
.Search input {
  width:0;
  opacity:0;
  transition:width .2s ease, opacity .2s ease;
  padding:6px 8px;
  border-radius:6px;
  border:1px solid #333;
  background:#232327;
  color:#fff;
  font-size:14px;
}
.Search.active input { width:140px; opacity:1; }
.Search button {
  background:#de1212;
  border:none;
  border-radius:6px;
  color:#fff;
  padding:8px;
  cursor:pointer;
  font-size:14px;
}

/* ===== FILTER BAR ===== */
.movie_filter_container {
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  justify-content:center;
  padding:10px;
}
.movie_filter_container select,
.movie_filter_container button {
  padding:8px 10px;
  border-radius:6px;
  font-size:14px;
  border:none;
}
.movie_filter_container select {
  background:#232327;
  color:#fff;
}
.movie_filter_container button {
  background:#de1212;
  color:#fff;
  font-weight:600;
}
.movie_filter_container #resetBtn { background:#555; }

/* ===== BANNER ===== */
.BannerContainer {
  margin:14px auto;
  max-width:1200px;
  border-radius:10px;
  overflow:hidden;
  position:relative;
}
.BannerGrid {
  display:flex;
  transition:transform .5s ease;
}
.BannerCard {
  flex:0 0 100%;
  position:relative;
}
.BannerPoster img {
  width:100%;
  height:220px; /* mobile default */
  object-fit:cover;
}
.BannerCard::after {
  content:"";
  position:absolute; left:0; right:0; bottom:0;
  height:40%;
  background:linear-gradient(to top, rgba(0,0,0,.8), transparent);
}
.BannerText {
  position:absolute;
  bottom:12px; left:12px;
  color:#fff;
  max-width:70%;
}
.BannerText h2 { font-size:16px; margin-bottom:6px; }
.BannerText p { font-size:13px; color:#ddd; }
.BannerNav {
  position:absolute;
  top:50%; transform:translateY(-50%);
  background:rgba(0,0,0,.5);
  border:none;
  color:#fff;
  padding:10px;
  border-radius:50%;
  cursor:pointer;
}
.BannerPrev { left:10px; }
.BannerNext { right:10px; }

/* ===== PLAYER ===== */
.player-container {
  width:100%;
  max-width:1000px;
  margin:14px auto;
  border-radius:8px;
  overflow:hidden;
  background:#000;
  aspect-ratio:16/9;
}
.player-container iframe,
.player-container video {
  width:100%; height:100%;
  border:0;
  object-fit:contain;
  background:#000;
}

/* ===== MOVIE GRID ===== */
.Grid {
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(140px,1fr));
  gap:12px;
  max-width:1200px;
  margin:0 auto;
  padding:10px;
}
.MovieCard {
  background:#1f1f23;
  border-radius:8px;
  overflow:hidden;
  text-align:center;
  position:relative;
}
.poster img {
  width:100%; height:200px;
  object-fit:cover;
  display:block;
}
.MovieCard h3 {
  font-size:13px;
  padding:6px;
  min-height:32px;
}
.badge, .episode-badge, .source-label {
  position:absolute;
  padding:4px 6px;
  font-size:11px;
  border-radius:4px;
  color:#fff;
}
.badge { top:6px; left:6px; background:#de1212; }
.episode-badge { bottom:6px; left:6px; background:#0078ff; }
.source-label { top:6px; right:6px; background:rgba(0,0,0,.6); }

/* ===== PAGINATION ===== */
#pagination {
  display:flex;
  justify-content:center;
  gap:6px;
  flex-wrap:wrap;
  margin:16px 0;
}
#pagination button {
  background:#333;
  color:#fff;
  border:none;
  border-radius:6px;
  padding:6px 10px;
  font-size:13px;
  min-width:34px; min-height:34px;
  cursor:pointer;
}
#pagination button:hover { background:#444; }
#pagination button.active {
  background:#de1212;
  font-weight:700;
}
#pagination .prev-btn, #pagination .next-btn { background:#555; }

/* ===== LOADER ===== */
.spinner {
  width:28px; height:28px;
  border:4px solid rgba(255,255,255,.2);
  border-top-color:#de1212;
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin:20px auto;
}
@keyframes spin { to { transform:rotate(360deg); } }

/* ===== RESPONSIVE ===== */
@media (min-width:600px) {
  .BannerPoster img { height:300px; }
  .poster img { height:220px; }
  .BannerText h2 { font-size:18px; }
}
@media (min-width:900px) {
  .BannerPoster img { height:400px; }
  .poster img { height:260px; }
  .Logo { font-size:22px; }
}

  </style>
</head>
<body>
  <header>
    <div class="Logo" id="logo">üé¨ B√°nh M√¨ üé¨</div>
    <div class="Top">
      
       
      <div class="Search" id="searchBox">
        <input id="searchInput" placeholder="Nh·∫≠p T√™n B√°nh..." aria-label="T√¨m ki·∫øm phim" />
        <button id="searchBtn" aria-label="T√¨m ki·∫øm">T√¨m B√°nh</button>
      </div>
    </div>
  </header>

  <!-- Banner Section -->
  <section class="BannerContainer">
    <h2 class="BannerTitle">üé¨ B√°nh M√¨...</h2>
  

  <section class="movie_filter_container">
    <select id="category" aria-label="Ch·ªçn th·ªÉ lo·∫°i">
      <option value="">üé• Th·ªÉ lo·∫°i üé•</option>
      <option value="hanh-dong">H√†nh ƒê·ªông</option>
      <option value="phieu-luu">Phi√™u L∆∞u</option>
      <option value="hoat-hinh">Ho·∫°t H√¨nh</option>
      <option value="hai">H√†i</option>
      <option value="hinh-su">H√¨nh S·ª±</option>
      <option value="tai-lieu">T√†i Li·ªáu</option>
      <option value="chinh-kich">Ch√≠nh K·ªãch</option>
      <option value="gia-dinh">Gia ƒê√¨nh</option>
      <option value="gia-tuong">Gi·∫£ T∆∞·ªüng</option>
      <option value="lich-su">L·ªãch S·ª≠</option>
      <option value="kinh-di">Kinh D·ªã</option>
      <option value="nhac">Nh·∫°c</option>
      <option value="bi-an">B√≠ ·∫®n</option>
      <option value="lang-man">L√£ng M·∫°n</option>
      <option value="khoa-hoc-vien-tuong">Khoa H·ªçc Vi·ªÖn T∆∞·ªüng</option>
      <option value="gay-can">G√¢y C·∫•n</option>
      <option value="chien-tranh">Chi·∫øn Tranh</option>
      <option value="tam-ly">T√¢m L√Ω</option>
      <option value="tinh-cam">T√¨nh C·∫£m</option>
      <option value="co-trang">C·ªï Trang</option>
      <option value="mien-tay">Mi·ªÅn T√¢y</option>
      <option value="phim-18">Phim 18+</option>
    </select>
    <select id="region" aria-label="Ch·ªçn qu·ªëc gia">
      <option value="">üé• Qu·ªëc gia üé•</option>
      <option value="au-my">√Çu M·ªπ</option>
      <option value="anh">Anh</option>
      <option value="trung-quoc">Trung Qu·ªëc</option>
      <option value="indonesia">Indonesia</option>
      <option value="viet-nam">Vi·ªát Nam</option>
      <option value="phap">Ph√°p</option>
      <option value="hong-kong">H·ªìng K√¥ng</option>
      <option value="han-quoc">H√†n Qu·ªëc</option>
      <option value="nhat-ban">Nh·∫≠t B·∫£n</option>
      <option value="thai-lan">Th√°i Lan</option>
      <option value="dai-loan">ƒê√†i Loan</option>
      <option value="nga">Nga</option>
      <option value="ha-lan">H√† Lan</option>
      <option value="philippines">Philippines</option>
      <option value="an-do">·∫§n ƒê·ªô</option>
      <option value="quoc-gia-khac">Qu·ªëc gia kh√°c</option>
      <option value="duc">ƒê·ª©c</option>
      <option value="tay-ban-nha">T√¢y Ban Nha</option>
      <option value="tho-nhi-ky">Th·ªï Nhƒ© K·ª≥</option>
      <option value="mexico">Mexico</option>
      <option value="ba-lan">Ba Lan</option>
      <option value="uc">√öc</option>
      <option value="thu·ªµ-den">Th·ª•y ƒêi·ªÉn</option>
      <option value="malaysia">Malaysia</option>
      <option value="brazil">Brazil</option>
      <option value="bo-dao-nha">B·ªì ƒê√†o Nha</option>
      <option value="y">√ù</option>
      <option value="dan-mach">ƒêan M·∫°ch</option>
      <option value="uae">UAE</option>
      <option value="na-uy">Na Uy</option>
      <option value="thu·ªµ-si">Th·ª•y Sƒ©</option>
      <option value="chau-phi">Ch√¢u Phi</option>
      <option value="nam-phi">Nam Phi</option>
      <option value="ukraina">Ukraina</option>
      <option value="a-rap-xe-ut">·∫¢ R·∫≠p X√™ √öt</option>
      <option value="bi">B·ªâ</option>
      <option value="ireland">Ireland</option>
      <option value="colombia">Colombia</option>
      <option value="phan-lan">Ph·∫ßn Lan</option>
      <option value="chile">Chile</option>
      <option value="hy-lap">Hy L·∫°p</option>
      <option value="nigeria">Nigeria</option>
      <option value="argentina">Argentina</option>
      <option value="singapore">Singapore</option>
    </select>
    <select id="year" aria-label="Ch·ªçn nƒÉm">
      <option value="">üé• NƒÉm üé•</option>
      <option value="2029">2029</option>
      <option value="2028">2028</option>
      <option value="2027">2027</option>
      <option value="2026">2026</option>
      <option value="2025">2025</option>
      <option value="2024">2024</option>
      <option value="2023">2023</option>
      <option value="2022">2022</option>
      <option value="2021">2021</option>
      <option value="2020">2020</option>
      <option value="2019">2019</option>
      <option value="2018">2018</option>
      <option value="2017">2017</option>
      <option value="2016">2016</option>
      <option value="2015">2015</option>
      <option value="2014">2014</option>
      <option value="2013">2013</option>
      <option value="2012">2012</option>
    </select>
    <select id="type" aria-label="Ch·ªçn lo·∫°i phim">
      <option value="">üéûÔ∏è Lo·∫°i üéûÔ∏è</option>
      <option value="phim-moi">Phim m·ªõi</option>
      <option value="phim-bo">Phim b·ªô</option>
      <option value="phim-le">Phim l·∫ª</option>
      <option value="shows">TV Shows</option>
      <option value="hoat-hinh">Ho·∫°t h√¨nh</option>
      <option value="phim-vietsub">Phim vietsub</option>
      <option value="phim-thuyet-minh">Phim thuy·∫øt minh</option>
      <option value="phim-long-tieng">Phim l·ªìng ti·∫øng</option>
      <option value="phim-bo-dang-chieu">Phim b·ªô ƒëang chi·∫øu</option>
      <option value="phim-bo-da-hoan-thanh">Phim b·ªô ƒë√£ ho√†n th√†nh</option>
      <option value="phim-sap-chieu">Phim s·∫Øp chi·∫øu</option>
      <option value="subteam">Subteam</option>
      <option value="phim-chieu-rap">Phim chi·∫øu r·∫°p</option>
    </select>
    <button id="filterBtn">Go</button>
    <button id="resetBtn">X√≥a b·ªô l·ªçc</button>
  </section>

  <main>
    <h2 id="sectionTitle">üé¨ Phim M·ªõi!</h2>
    <div class="Grid" id="movieList"><div class="spinner"></div></div>
 
 <script>
/* === Full index JS (thay th·∫ø to√†n b·ªô ph·∫ßn script c≈©) === */

/* Lazyload polyfill */
if (!("loading" in HTMLImageElement.prototype)) {
  const s = document.createElement("script");
  s.src = "https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js";
  s.async = true;
  document.head.appendChild(s);
}

/* Config sources (gi·ªØ nguy√™n nh∆∞ b·∫°n) */
const sources = [
  { name: "üçû B√°nh M√¨ 01", base: "https://ophim1.com/v1/api", type: "ophim" },
  { name: "üçû B√°nh M√¨ 02", base: "https://phimapi.com/v1/api", type: "phimapi" },
  { name: "üçû B√°nh M√¨ 03", base: "https://phim.nguonc.com/api", type: "nguonc" }
];

const labels = { /* ...gi·ªØ nh∆∞ c≈© n·∫øu c·∫ßn... */ };

/* DOM refs */
const movieList = document.getElementById("movieList");
const bannerList = document.getElementById("bannerList");
const searchInput = document.getElementById("searchInput");
const searchBtn = document.getElementById("searchBtn");
const filterBtn = document.getElementById("filterBtn");
const resetBtn = document.getElementById("resetBtn");
const menuBtn = document.getElementById("menuBtn");
const sectionTitle = document.getElementById("sectionTitle");
const bannerPrev = document.getElementById("bannerPrev");
const bannerNext = document.getElementById("bannerNext");

/* pagination element: n·∫øu ch∆∞a c√≥ th√¨ t·ª± t·∫°o v√† ch√®n ngay d∆∞·ªõi movieList */
let pagination = document.getElementById("pagination");
if (!pagination) {
  pagination = document.createElement("div");
  pagination.id = "pagination";
  pagination.className = "pagination";
  if (movieList && movieList.parentNode) movieList.parentNode.insertBefore(pagination, movieList.nextSibling);
  else document.body.appendChild(pagination);
  console.log("[pagination] created dynamically");
}

/* State */
let currentPage = 1;
let lastMode = "normal"; // normal | search | filter
const PAGE_BLOCK = 6;    // hi·ªÉn th·ªã 6 n√∫t m·ªói block
let totalPages = 50;     // fallback n·∫øu API kh√¥ng tr·∫£ v·ªÅ t·ªïng
const cache = new Map();

/* Helpers */
function slugify(text) {
  if (!text) return "";
  return text.toString().toLowerCase()
    .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
    .replace(/ƒë/g, "d").replace(/ƒê/g, "D")
    .replace(/[^a-z0-9\s-]/g, "")
    .trim().replace(/\s+/g, "-");
}
function fixImagePath(img, src) {
  if (!img) return "";
  if (img.startsWith("http")) return img;
  if (src?.type === "ophim") return "https://img.ophim.live/uploads/movies" + (img.startsWith("/") ? img : "/" + img);
  if (src?.type === "phimapi") return "https://phimimg.com" + (img.startsWith("/") ? img : "/" + img);
  return img.startsWith("/") ? img : "/" + img;
}
function extractItems(data) {
  if (!data) return [];
  if (Array.isArray(data)) return data;
  if (data.data?.items) return data.data.items;
  if (data.items) return data.items;
  if (Array.isArray(data.data)) return data.data;
  if (data.data?.item) return [data.data.item];
  if (data.movie) return [data.movie];
  return [];
}

/* Try list of URLs and return first working response + raw JSON */
async function tryUrls(urls) {
  for (const u of urls) {
    if (cache.has(u)) return cache.get(u);
    try {
      const res = await fetch(u);
      if (!res.ok) continue;
      const json = await res.json();
      // n·∫øu c√≥ d·ªØ li·ªáu h·ª£p l·ªá
      if (extractItems(json).length || json.data?.item || json.movie) {
        cache.set(u, json);
        return json;
      }
    } catch (e) {
      // ignore
    }
  }
  return null;
}

/* ---------------- Banner (gi·ªØ logic b·∫°n mu·ªën) ---------------- */
async function fetchBanner() {
  try {
    const res = await fetch("");
    const json = await res.json();
    const items = extractItems(json).slice(0, 10);
    if (!items.length) {
      bannerList.innerHTML = `<p class="small-note">Kh√¥ng c√≥ d·ªØ li·ªáu banner.</p>`;
      return;
    }
    bannerList.innerHTML = items.map(it => {
      const img = fixImagePath(it.poster_url || it.thumb || it.image || it.poster, sources[0]);
      const detailHref = `detail.html?slug=${encodeURIComponent(slugify(it.name || it.title || ""))}&src=${encodeURIComponent(sources[0].name)}`;
      return `<div class="BannerCard" onclick="location.href='${detailHref}'"><div class="BannerPoster"><img loading="lazy" src="${img}" alt=""></div></div>`;
    }).join("");
    // optional: implement slide controls if you want (omitted for brevity)
  } catch (e) {
    bannerList.innerHTML = `<p class="small-note">L·ªói t·∫£i banner.</p>`;
  }
}

/* ---------------- Fetch movies from multi sources ----------------
   RETURN: { items: [...], detectedTotalPages: number|null }
-----------------------------------------------------------------*/
async function fetchMovies({ keyword = "", filters = {}, page = 1, mode = "normal" } = {}) {
  const perSourceResults = [];
  let detectedTotalPages = null;

  for (const src of sources) {
    const candidates = [];

    if (mode === "search" && keyword) {
      const slugKey = slugify(keyword);
      if (src.type === "nguonc") {
        candidates.push(`${src.base}/film/${slugKey}`);
      } else {
        candidates.push(`${src.base}/tim-kiem?keyword=${encodeURIComponent(keyword)}`);
        candidates.push(`${src.base}/phim/${slugKey}`);
      }
    } else if (mode === "filter") {
      const { category, region, year, type } = filters;
      if (src.type === "ophim") {
        if (category) candidates.push(`${src.base}/the-loai/${encodeURIComponent(category)}?page=${page}`);
        if (region) candidates.push(`${src.base}/quoc-gia/${encodeURIComponent(region)}?page=${page}`);
        if (year) candidates.push(`${src.base}/nam-phat-hanh/${encodeURIComponent(year)}?page=${page}`);
      } else if (src.type === "phimapi") {
        if (category) candidates.push(`${src.base}/the-loai/${encodeURIComponent(category)}?page=${page}`);
      } else if (src.type === "nguonc") {
        if (category) candidates.push(`${src.base}/films/the-loai/${encodeURIComponent(category)}?page=${page}`);
      }
    } else {
      // normal
      if (src.type === "ophim") {
        candidates.push(`${src.base}/danh-sach/phim-moi?page=${page}`);
        candidates.push(`${src.base}/danh-sach?page=${page}`);
      } else if (src.type === "phimapi") {
        candidates.push(`${src.base}/danh-sach/phim-moi?page=${page}`);
      } else if (src.type === "nguonc") {
        candidates.push(`${src.base}/films?page=${page}`);
      }
    }

    const unique = [...new Set(candidates.filter(Boolean))];
    if (!unique.length) continue;

    const json = await tryUrls(unique);
    if (!json) {
      perSourceResults.push([]);
      continue;
    }

    // try detect total pages from common response shapes
    if (!detectedTotalPages) {
      if (json.total_pages) detectedTotalPages = Number(json.total_pages);
      else if (json.meta?.pagination?.total_pages) detectedTotalPages = Number(json.meta.pagination.total_pages);
      else if (json.data?.meta?.pagination?.total_pages) detectedTotalPages = Number(json.data.meta.pagination.total_pages);
      else if (json.data?.total) {
        // if API gives items total count and we know page size later, we'll compute in caller
        detectedTotalPages = null; // keep null for now
      }
    }

    const items = extractItems(json);
    const mapped = items.map(item => {
      const imgRaw = item.thumb_url || item.poster_url || item.image || item.thumb || item.poster;
      return {
        name: item.name || item.title || item.ten || "",
        year: item.year || item.release_date || item.nam || "",
        episode: item.episode_current || item.episode || "",
        poster: fixImagePath(imgRaw, src),
        source: src.name,
        slug: item.slug || slugify(item.name || item.title || "")
      };
    });
    perSourceResults.push(mapped);
  }

  // merge interleaving like before
  const results = [];
  const maxLen = perSourceResults.length ? Math.max(...perSourceResults.map(a => a.length)) : 0;
  for (let i = 0; i < maxLen; i++) {
    for (const arr of perSourceResults) {
      if (arr[i]) results.push(arr[i]);
    }
  }

  return { items: results, detectedTotalPages };
}

/* ---------------- fetchMoviesFull - render v√† ƒëi·ªÅu ch·ªânh totalPages ---------------- */
async function fetchMoviesFull({ keyword = "", filters = {}, page = 1, mode = "normal" } = {}) {
  if (!movieList) return;
  movieList.innerHTML = `<div class="spinner"></div>`;
  const { items, detectedTotalPages } = await fetchMovies({ keyword, filters, page, mode });

  const isLaptop = window.innerWidth >= 1024;
  const limit = isLaptop ? 10 : 6;
  // Update totalPages if API gave it
  if (detectedTotalPages && Number.isInteger(detectedTotalPages) && detectedTotalPages > 0) {
    totalPages = detectedTotalPages;
  } else {
    // If API didn't give total pages:
    // - if returned items < limit then assume this is last page -> totalPages = page
    // - else ensure we allow showing some future pages so pagination isn't locked at 1
    if (items.length < limit) {
      totalPages = Math.max(totalPages, page); // likely last page
    } else {
      // allow at least current block + 2 blocks ahead (heuristic)
      totalPages = Math.max(totalPages, page + PAGE_BLOCK * 2);
    }
  }

  // render list (limit)
  const display = items.slice(0, limit);
  movieList.innerHTML = display.length === 0
    ? `<p class="small-note">Kh√¥ng t√¨m th·∫•y phim. Vui l√≤ng th·ª≠ l·∫°i ho·∫∑c thay ƒë·ªïi b·ªô l·ªçc.</p>`
    : display.map(m => {
        const detailHref = `detail.html?slug=${encodeURIComponent(m.slug)}&src=${encodeURIComponent(m.source)}`;
        return `
          <div class="MovieCard" onclick="location.href='${detailHref}'" role="link" aria-label="Xem chi ti·∫øt phim ${m.name || 'Kh√¥ng t√™n'}">
            <div class="poster">
              <span class="source-label">${m.source}</span>
              <img loading="lazy" src="${m.poster}" alt="Poster phim ${m.name || 'Kh√¥ng t√™n'}" />
              ${m.year ? `<span class="badge">${m.year}</span>` : ""}
              ${m.episode ? `<span class="episode-badge">${m.episode}</span>` : ""}
             
            </div>
            <h3>${m.name || ""}</h3>
          </div>`;
      }).join("");

  renderPagination(page, totalPages);
}

/* ---------------- Pagination render + navigation ---------------- */
function renderPagination(current, total) {
  if (!pagination) return;
  pagination.innerHTML = "";

  // Ensure total at least 1
  total = Math.max(1, Number(total) || 1);

  const blockStart = Math.floor((current - 1) / PAGE_BLOCK) * PAGE_BLOCK + 1;
  const blockEnd = Math.min(blockStart + PAGE_BLOCK - 1, total);

  // prev block button
  if (blockStart > 1) {
    const btn = document.createElement("button");
    btn.className = "page-btn";
    btn.textContent = "¬´";
    btn.onclick = () => goToPage(blockStart - 1);
    pagination.appendChild(btn);
  }

  // page buttons within block
  for (let i = blockStart; i <= blockEnd; i++) {
    const btn = document.createElement("button");
    btn.className = "page-btn";
    btn.textContent = i;
    if (i === current) btn.classList.add("active");
    btn.onclick = () => goToPage(i);
    pagination.appendChild(btn);
  }

  // next block
  if (blockEnd < total) {
    const btn = document.createElement("button");
    btn.className = "page-btn";
    btn.textContent = "¬ª";
    btn.onclick = () => goToPage(blockEnd + 1);
    pagination.appendChild(btn);
  }
}

function goToPage(page) {
  currentPage = page;
  if (lastMode === "search") {
    fetchMoviesFull({ keyword: searchInput?.value?.trim() || "", page, mode: "search" });
  } else if (lastMode === "filter") {
    fetchMoviesFull({ filters: getFilters(), page, mode: "filter" });
  } else {
    fetchMoviesFull({ page, mode: "normal" });
  }
}

/* ---------------- UI events (search/filter/reset/menu) ---------------- */
function getFilters() {
  return {
    category: document.getElementById("category")?.value || "",
    region: document.getElementById("region")?.value || "",
    year: document.getElementById("year")?.value || "",
    type: document.getElementById("type")?.value || ""
  };
}

searchBtn?.addEventListener("click", () => {
  const q = searchInput?.value?.trim();
  if (!q) {
    // toggle search box
    document.getElementById("searchBox")?.classList.toggle("active");
    searchInput?.focus();
    return;
  }
  currentPage = 1;
  lastMode = "search";
  fetchMoviesFull({ keyword: q, page: 1, mode: "search" });
});

filterBtn?.addEventListener("click", () => {
  currentPage = 1;
  lastMode = "filter";
  const f = getFilters();
  fetchMoviesFull({ filters: f, page: 1, mode: "filter" });
});

resetBtn?.addEventListener("click", () => {
  document.getElementById("category") && (document.getElementById("category").value = "");
  document.getElementById("region") && (document.getElementById("region").value = "");
  document.getElementById("year") && (document.getElementById("year").value = "");
  document.getElementById("type") && (document.getElementById("type").value = "");
  if (searchInput) searchInput.value = "";
  currentPage = 1;
  lastMode = "normal";
  sectionTitle && (sectionTitle.textContent = "üé¨ Phim M·ªõi!");
  fetchMoviesFull({ page: 1, mode: "normal" });
});

menuBtn?.addEventListener("click", (e) => {
  e.stopPropagation();
  menuBtn.classList.toggle("active");
});
document.addEventListener("click", () => menuBtn && menuBtn.classList && menuBtn.classList.remove("active"));

/* ---------------- Init on load ---------------- */
window.addEventListener("DOMContentLoaded", () => {
  fetchBanner();
  fetchMoviesFull({ page: 1, mode: "normal" });
});
</script>

</body>
</html>