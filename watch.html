<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Xem Phim</title>

  <!-- Preload HLS.js -->
  <link rel="preload" href="https://cdn.jsdelivr.net/npm/hls.js@1.6.13" as="script">
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.6.13"></script>
  <link rel="stylesheet" href="player.css">
<script src="player.js" defer></script>

</head>
<body>

  <div class="bg-blur" id="bg"></div>
  <div class="overlay"></div>

  <div class="main-container">
    <div class="title-bar" id="title-bar">Tên Phim: Đang tải... | Tập: 1</div>
    <div id="player-area">
      <div class="loading-overlay"><div class="spinner"></div></div>
      <video id="hls-video" playsinline controls preload="none" style="display:none"></video>
      <iframe id="embed-frame" style="display:none" allowfullscreen allow="autoplay" loading="lazy"></iframe>
      <div class="error-msg" id="error-msg" style="display:none;position:absolute;inset:0;background:rgba(0,0,0,.8);color:#f66;display:flex;align-items:center;justify-content:center;font-size:1.15rem;">Lỗi phát nguồn này</div>
    </div>

    <div class="bar" id="source-mode-bar"></div>
    <div class="bar" id="server-select"></div>

    <div class="bar" id="ctl-bar">
      <button class="btn" onclick="prevEp()">Tập trước</button>
      <button class="btn" onclick="seek(-40)">-40s</button>
      <button class="btn" onclick="seek(40)">+40s</button>
      <button class="btn" onclick="nextEp()">Tập sau</button>
      <label class="btn upload"><input type="file" id="vi-sub" accept=".vtt,.srt" hidden> Vi Sub</label>
      <label class="btn upload"><input type="file" id="en-sub" accept=".vtt,.srt" hidden> En Sub</label>
    </div>

    <div class="ep-grid" id="ep-grid"></div>

    <div class="plot-container" id="plot-container">
      <h3>Cốt truyện</h3>
      <p id="plot-text">Đang tải nội dung phim...</p>
    </div>

    <a class='back-btn' href='/'>Quay lại Trang Chủ</a>
  </div>

  <div id="toast">Thông báo</div>

  <div id="popup-confirm">
    <div id="popup-box">
      <p>Bạn có muốn chuyển sang tập kế tiếp không?</p>
      <button class="popup-btn popup-yes">Có</button>
      <button class="popup-btn popup-no">Không</button>
    </div>
  </div>
