<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xem Phim Online - Danh Sách</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #0f1419;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #fff;
        }

        h1 {
            text-align: center;
            font-size: 2em;
            margin-bottom: 20px;
            color: #ff4444;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .category-menu {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .category-link {
            color: #ff4444;
            text-decoration: none;
            font-size: 1.2em;
            padding: 8px 16px;
            border: 2px solid #ff4444;
            border-radius: 5px;
            transition: background 0.3s ease, color 0.3s ease;
        }

        .category-link:hover {
            background: #ff4444;
            color: #fff;
        }

        .movie-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .movie-card {
            position: relative;
            width: 180px;
            text-decoration: none;
            color: inherit;
            transition: transform 0.3s ease;
            margin: 0 auto;
        }

        .movie-poster {
            width: 100%;
            height: auto;
            max-height: 270px;
            border: 2px solid white;
            border-radius: 8px;
            display: block;
            transition: transform 0.3s ease;
        }

        .movie-title {
            padding: 8px 0;
            font-size: 1em;
            font-weight: bold;
            text-align: center;
            color: #fff;
        }

        .movie-card:hover {
            transform: scale(1.05);
        }

        @media (max-width: 600px) {
            .movie-container {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            .movie-card {
                width: 150px;
            }
            .movie-poster {
                max-height: 225px;
            }
            .category-menu {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <h1>Phim Bộ Hot 2025</h1>
    <div class="category-menu">
        <a href="phim-my.html" class="category-link">Phim Mỹ</a>
        <a href="phim-viet.html" class="category-link">Phim Việt</a>
        <a href="phim-han.html" class="category-link">Phim Hàn</a>
    </div>
    <div class="movie-container" id="movieContainer"></div>

    <script>
        // Danh sách API phim
        const apiUrls = [
            'https://cors-anywhere.herokuapp.com/https://ophim1.com/phim/yeu-em',
            // Thêm API phim khác nếu muốn
            'https://cors-anywhere.herokuapp.com/https://ophim1.com/phim/rang-buoc-toi-loi'
        ];

        // Gọi tất cả API cùng lúc
        Promise.all(apiUrls.map(url => 
            fetch(url)
                .then(response => response.json())
                .catch(err => {
                    console.error(`Lỗi khi gọi API ${url}:`, err);
                    return null;
                })
        ))
        .then(results => {
            const container = document.getElementById('movieContainer');
            results.forEach(data => {
                if (!data || !data.status || !data.movie) return;

                const movie = data.movie;
                const title = movie.name;
                const poster = movie.poster_url;
                const seriesId = movie.slug; // Dùng slug từ API thay vì tự tạo
                const episodes = data.episodes[0].server_data.map(ep => ({
                    title: `Tập ${ep.name}`,
                    url: ep.link_m3u8
                }));

                const card = document.createElement('a');
                card.href = `series.html?id=${seriesId}`;
                card.className = 'movie-card';
                card.innerHTML = `
                    <img src="${poster}" class="movie-poster" alt="${title}">
                    <div class="movie-title">${title}</div>
                `;
                container.appendChild(card);

                // Lưu dữ liệu vào localStorage
                localStorage.setItem(seriesId, JSON.stringify({
                    title,
                    poster,
                    episodes
                }));
            });
        })
        .catch(error => console.error('Lỗi khi tải dữ liệu API:', error));
    </script>
</body>
</html>