<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title id="page-title">Movies</title>
    <!-- SEO -->
    <meta property="og:title" content="" id="og-title" />
    <meta property="og:description" content="" id="og-desc" />
    <meta property="og:image" content="" id="og-image" />
    <meta property="og:url" content="" id="og-url" />
    <meta property="og:type" content="video.movie" />
<style>
/* ======== RESET ======== */
*{margin:0;padding:0;box-sizing:border-box;}
body{background:#000;color:#fff;font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display",Roboto,sans-serif;overflow-x:hidden;line-height:1.5;}
a{text-decoration:none;color:inherit;}
img{user-select:none;-webkit-user-drag:none;pointer-events:none;}

/* ======== BACKGROUND ======== */
.bg-poster{position:fixed;top:0;left:0;width:100%;height:100%;background-size:cover;background-position:center;filter:blur(12px) brightness(0.3);z-index:-2;}
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);z-index:-1;}

/* ======== CONTAINER ======== */
.container{max-width:1200px;margin:0 auto;padding:0 1rem;position:relative;z-index:10;}

/* ======== HEADER ======== */
header{background:rgba(17,17,17,.95);backdrop-filter:blur(20px);padding:10px 0;position:sticky;top:0;z-index:100;border-bottom:1px solid rgba(255,255,255,.08);}
.nav{display:flex;justify-content:space-between;align-items:center;max-width:1200px;margin:0 auto;padding:0 1rem;}
.logo{font-size:1.1rem;font-weight:700;color:#fff;letter-spacing:-.5px;cursor:pointer;}
.back-home{background:#0a84ff;color:#fff;padding:6px 12px;border-radius:16px;font-size:.85rem;font-weight:500;transition:all .25s;cursor:pointer;}
.back-home:hover{background:#006edc;transform:scale(1.04);}

/* ======== INFO CARD ======== */
.info-card{background:#111;padding:1.5rem;border-radius:12px;border:1px solid rgba(255,255,255,.08);box-shadow:0 8px 24px rgba(0,0,0,.5);margin-top:1.5rem;}

/* ======== LAYOUT: POSTER + INFO (BÊN PHẢI) ======== */
.detail-wrapper{display:flex;gap:1.5rem;align-items:flex-start;}
.poster-wrapper{flex:0 0 220px;position:relative;perspective:1000px;display:flex;flex-direction:column;align-items:center;}
.info-wrapper{flex:1;min-width:0;display:flex;flex-direction:column;gap:0.8rem;}

/* ======== POSTER TILT EFFECT - GIỐNG ROPHIM ======== */
.tilt-card{width:220px;height:330px;position:relative;transform-style:preserve-3d;transition:transform .15s ease-out;box-shadow:0 6px 16px rgba(0,0,0,.6);border-radius:10px;overflow:hidden;cursor:pointer;}
.tilt-card:hover{box-shadow:0 16px 32px rgba(0,0,0,.8);}
.poster-front{width:100%;height:100%;object-fit:cover;border-radius:10px;transition:filter .3s;}
.tilt-card:hover .poster-front{filter:brightness(1.15);}
.tilt-overlay{position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,rgba(255,255,255,.1),transparent 40%,rgba(0,0,0,.4));opacity:0;transition:opacity .3s;pointer-events:none;}
.tilt-card:hover .tilt-overlay{opacity:1;}
.tilt-glare{position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle at 50% 50%,rgba(255,255,255,.25),transparent 40%);opacity:0;transition:opacity .3s;pointer-events:none;}
.tilt-card:hover .tilt-glare{opacity:1;}

/* ======== TEXT ======== */
.title{font-size:1.6rem;font-weight:700;color:#0a84ff;margin-bottom:.4rem;}
.original-title{font-size:0.95rem;color:#aaa;margin-bottom:.4rem;font-style:italic;}

/* ======== DESCRIPTION ======== */
.desc{line-height:1.6;max-height:100px;overflow:hidden;transition:max-height .4s ease;color:#ddd;font-size:.9rem;}
.desc.expanded{max-height:800px;}
.toggle-desc{color:#0a84ff;cursor:pointer;font-weight:600;margin-top:.5rem;display:inline-block;font-size:.85rem;}
.toggle-desc:hover{text-decoration:underline;}

/* ======== ACTIONS ======== */
.actions{display:flex;gap:10px;margin-top:.4rem;flex-wrap:wrap;justify-content:center;}
.btn{padding:10px 20px;border-radius:16px;font-weight:600;display:inline-flex;align-items:center;gap:6px;font-size:.9rem;transition:all .25s;}
.btn-primary{background:#0a84ff;color:#fff;}
.btn-primary:hover{background:#006edc;transform:scale(1.04);}

/* ======== SKELETON ======== */
.skeleton{background:#222;border-radius:8px;animation:pulse 1.5s ease-in-out infinite;}
@keyframes pulse{0%{opacity:.6}50%{opacity:1}100%{opacity:.6}}

/* ======== RESPONSIVE ======== */
@media (max-width:992px){
    .poster-wrapper{flex:0 0 200px;}
    .tilt-card{width:200px;height:300px;}
    .info-card{padding:1.2rem;}
}
@media (max-width:768px){
    .detail-wrapper{flex-direction:column;align-items:center;gap:1rem;}
    .poster-wrapper{flex:0 0 100%;max-width:280px;}
    .tilt-card{width:280px;height:420px;}
    .title{font-size:1.4rem;text-align:center;}
    .actions{justify-content:center;}
    .container{padding:0 0.8rem;}
}
@media (max-width:480px){
    .desc{font-size:.85rem;}
    .nav{padding:0 0.8rem;}
    .back-home{font-size:.8rem;padding:5px 10px;}
    .tilt-card{width:240px;height:360px;}
}
</style>
</head>
<body>
    <div class="bg-poster" id="bg-poster"></div>
    <div class="overlay"></div>
    <header>
        <div class="nav">
            <div class="logo" onclick="location.href='index.html'">Phim Nhà Bánh Mì</div>
            <a class='back-home' href='/'>Quay Lại</a>
        </div>
    </header>
    <div class="container">
        <div id="skeleton" style="display:block;">
            <div class="info-card">
                <div class="detail-wrapper">
                    <div class="poster-wrapper"><div class="skeleton" style="width:220px;height:330px;"></div></div>
                    <div class="info-wrapper">
                        <div class="skeleton" style="height:28px;width:70%;margin:8px 0;"></div>
                        <div class="skeleton" style="height:18px;width:50%;"></div>
                        <div class="skeleton" style="height:18px;width:60%;margin:6px 0;"></div>
                        <div class="skeleton" style="height:18px;width:50%;"></div>
                        <div class="skeleton" style="height:80px;margin:16px 0;"></div>
                    </div>
                </div>
            </div>
        </div>
        <div id="detail-content" style="display:none;">
            <div class="info-card">
                <div class="detail-wrapper">
                    <div class="poster-wrapper">
                        <div class="tilt-card" id="tiltCard">
                            <img id="poster" class="poster-front" src="" alt="" draggable="false">
                            <div class="tilt-overlay"></div>
                            <div class="tilt-glare"></div>
                        </div>
                        <div class="actions">
                            <a id="watch-btn" class="btn btn-primary">Xem Ngay</a>
                        </div>
                    </div>
                    <div class="info-wrapper">
                        <h1 id="title" class="title"></h1>
                        <p id="original-title" class="original-title"></p>
                        <p id="desc" class="desc"></p>
                        <span id="toggle-desc" class="toggle-desc">Xem thêm</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const slug = urlParams.get("slug");
        let source = urlParams.get("source") || "ax";
        const sourceMap = { "ax": "Ophim", "bx": "Phimapi", "cx": "Nguonc" };
        source = sourceMap[source] || "Ophim";
        const apis = {
            Ophim: `https://ophim1.com/v1/api/phim/${slug}`,
            Phimapi: `https://phimapi.com/phim/${slug}`,
            Nguonc: `https://phim.nguonc.com/api/film/${slug}`,
        };
        function getPoster(movie, cdn = "") {
            let url = "";
            if (source === "Phimapi") url = movie.poster_url || movie.thumb_url;
            else if (source === "Ophim") {
                url = movie.poster_url || movie.thumb_url;
                if (url && !url.includes('/uploads/movies/')) {
                    const name = url.split('/').pop().replace('-poster.jpg', '').replace('-thumb.jpg', '');
                    url = `${cdn || 'https://img.ophim.live'}/uploads/movies/${name}-thumb.jpg`;
                }
            }
            else if (source === "Nguonc") url = movie.thumb_url || movie.thumb_url;
            if (url && cdn && !url.startsWith('http')) url = cdn + '/' + url.replace(/^\//, '');
            return url || 'https://via.placeholder.com/220x330/111/fff?text=No+Image';
        }
        // === Hiệu ứng nghiêng 3D khi di chuột (giống RoPhim) ===
        let isHovering = false;
        document.addEventListener('mousemove', (e) => {
            if (!isHovering) return;
            const card = document.getElementById('tiltCard');
            if (!card) return;
            const rect = card.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const centerX = rect.width / 2;
            const centerY = rect.height / 2;
            const rotateX = (y - centerY) / centerY * -15;
            const rotateY = (x - centerX) / centerX * 15;
            card.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.05)`;
        });
        const tiltCard = document.getElementById('tiltCard');
        if (tiltCard) {
            tiltCard.addEventListener('mouseenter', () => { isHovering = true; });
            tiltCard.addEventListener('mouseleave', () => {
                isHovering = false;
                tiltCard.style.transform = 'rotateX(0deg) rotateY(0deg) scale(1)';
            });
        }
        async function loadDetail() {
            const skeleton = document.getElementById("skeleton");
            const content = document.getElementById("detail-content");
            const bg = document.getElementById("bg-poster");
            if (!slug) {
                content.innerHTML = `<p style="color:#f66;text-align:center;">Không có phim!</p>`;
                skeleton.style.display = 'none'; content.style.display = 'block';
                return;
            }
            try {
                const res = await fetch(apis[source]);
                if (!res.ok) throw new Error("Không tải được phim");
                const data = await res.json();
                let movie = {}, episodes = [], cdn = "";
                if (source === "Nguonc") { movie = data.movie; episodes = movie.episodes; }
                else if (source === "Phimapi") { movie = data.movie; episodes = data.episodes; }
                else if (source === "Ophim") { movie = data.data.item; episodes = movie.episodes; cdn = data.data.APP_DOMAIN_CDN_IMAGE || "https://img.ophim.live"; }
                const poster = getPoster(movie, cdn);
                document.getElementById('poster').src = poster;
                bg.style.backgroundImage = `url(${poster})`;
                document.getElementById('title').textContent = movie.name || "Không rõ";
                document.getElementById('original-title').textContent = movie.origin_name || "";
                const fullDesc = (movie.content || movie.description || "Không có mô tả").replace(/<[^>]+>/g, '').trim();
                const descEl = document.getElementById('desc');
                descEl.textContent = fullDesc;
                const toggleBtn = document.getElementById('toggle-desc');
                if (fullDesc.length > 200) {
                    toggleBtn.style.display = 'inline-block';
                    toggleBtn.onclick = () => {
                        descEl.classList.toggle('expanded');
                        toggleBtn.textContent = descEl.classList.contains('expanded') ? 'Thu gọn' : 'Xem thêm';
                    };
                } else {
                    toggleBtn.style.display = 'none';
                }
                // Cài đặt nút Xem Ngay cho phim lẻ
                const encodedSource = Object.keys(sourceMap).find(k => sourceMap[k] === source);
                document.getElementById('watch-btn').href = `watch.html?slug=${slug}&source=${encodedSource}&e=1`;
                document.getElementById('page-title').textContent = `${movie.name} - Phim Nhà Bánh Mì`;
                document.getElementById('og-title').content = movie.name;
                document.getElementById('og-desc').content = fullDesc.substring(0, 160) + '...';
                document.getElementById('og-image').content = poster;
                document.getElementById('og-url').content = location.href;
                skeleton.style.display = 'none';
                content.style.display = 'block';
            } catch (err) {
                console.error(err);
                content.innerHTML = `<p style="color:#f66;text-align:center;">Lỗi: ${err.message}</p>`;
                skeleton.style.display = 'none';
                content.style.display = 'block';
            }
        }
        document.addEventListener("DOMContentLoaded", loadDetail);
    </script>
</body>
</html>
