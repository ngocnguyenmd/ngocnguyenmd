<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phim B√°nh M√¨ 02</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Netflix Sans', 'Helvetica Neue', Arial, sans-serif;
            -webkit-tap-highlight-color: transparent; /* Gi·∫£m highlight khi ch·∫°m */
        }

        body {
            background: #141414;
            color: #fff;
            overflow-x: hidden;
            -webkit-user-select: none; /* NgƒÉn ch·ªçn vƒÉn b·∫£n khi ch·∫°m */
            user-select: none;
        }

        .header {
            background: linear-gradient(to bottom, rgba(0,0,0,0.95), rgba(0,0,0,0.6));
            padding: 15px 40px;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 10px rgba(0,0,0,0.7);
            transition: background 0.3s ease;
        }

        .header.scrolled {
            background: rgba(0,0,0,0.95);
        }

        .logo {
            font-size: 32px;
            font-weight: bold;
            color: #e50914;
            text-transform: uppercase;
            letter-spacing: 3px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap; /* Cho ph√©p xu·ªëng d√≤ng tr√™n m√†n h√¨nh nh·ªè */
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .search-bar {
            position: relative;
            margin: 0 15px;
        }

        .search-bar input {
            padding: 10px 40px 10px 15px;
            border: none;
            border-radius: 30px;
            background: #222;
            color: #fff;
            width: 200px;
            font-size: 14px;
            transition: all 0.4s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }

        .search-bar input:focus {
            outline: none;
            background: #333;
            width: 240px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.7);
        }

        .search-bar::after {
            content: 'üîç';
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #fff;
            font-size: 18px;
        }

        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-btn {
            background: #e50914;
            color: #fff;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            border-radius: 30px;
            font-size: 14px;
            font-weight: bold;
            transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
        }

        .dropdown-btn:hover {
            background: #b20710;
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.5);
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background: #222;
            min-width: 200px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.7);
            z-index: 1;
            border-radius: 10px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px 0;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dropdown-content a {
            color: #fff;
            padding: 12px 20px;
            text-decoration: none;
            display: block;
            font-size: 14px;
            transition: background 0.3s ease, padding-left 0.3s ease, color 0.3s ease;
        }

        .dropdown-content a:hover {
            background: #e50914;
            padding-left: 25px;
            color: #fff;
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }

        .notification img {
            width: 32px;
            height: 32px;
            filter: invert(1);
            transition: transform 0.3s ease;
        }

        .notification img:hover {
            transform: scale(1.1);
        }

        .banner {
            height: 10%;
            margin-top: 80px;
            position: relative;
            overflow: hidden;
            background: linear-gradient(to bottom, transparent, #141414);
        }

        .banner img {
            width: 100%;
            height: 500px;
            object-fit: cover;
            opacity: 0.85;
            transition: transform 0.6s ease, opacity 0.6s ease;
        }

        .banner:hover img {
            transform: scale(1.1);
            opacity: 0.9;
        }

        .banner-info {
            position: absolute;
            bottom: 40px;
            left: 40px;
            max-width: 600px;
        }

        .banner-info h2 {
            font-size: 40px;
            font-weight: bold;
            text-shadow: 4px 4px 8px rgba(0,0,0,0.9);
            margin-bottom: 15px;
            animation: fadeIn 1.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .container {
            padding: 40px;
            max-width: 1700px;
            margin: 0 auto;
        }

        .section-title {
            font-size: 30px;
            font-weight: bold;
            margin-bottom: 25px;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            animation: slideIn 0.6s ease;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 50px;
            height: 3px;
            background: #e50914;
            transition: width 0.3s ease;
        }

        .section-title:hover::after {
            width: 80px;
        }

        @keyframes slideIn {
            from { transform: translateX(-30px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .movie-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 20px;
            padding: 10px 0;
        }

        .movie-item {
            position: relative;
            cursor: pointer;
            overflow: hidden;
            border-radius: 10px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.5);
            transition: transform 0.4s ease, box-shadow 0.4s ease;
            touch-action: manipulation; /* C·∫£i thi·ªán ch·∫°m tr√™n mobile */
        }

        .movie-item:hover {
            transform: translateY(-8px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.7);
        }

        .movie-item img {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 10px;
            display: block;
            transition: transform 0.5s ease;
            touch-action: manipulation; /* NgƒÉn ch·∫°m nh·∫ßm */
        }

        .movie-item:hover img {
            transform: scale(1.15);
        }

        .movie-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(0,0,0,0.3), rgba(0,0,0,0.9));
            opacity: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
            transition: opacity 0.4s ease;
            touch-action: manipulation; /* NgƒÉn ch·∫°m nh·∫ßm */
        }

        .movie-item:hover .movie-overlay {
            opacity: 1;
        }

        .movie-overlay span {
            color: #fff;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            padding: 0 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            line-height: 1.2;
        }

        .movie-overlay .play-btn {
            margin-top: 10px;
            background: #e50914;
            color: #fff;
            padding: 8px 15px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.2s ease;
        }

        .movie-overlay .play-btn:hover {
            background: #b20710;
            transform: scale(1.05);
        }

        .movie-status {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 8px 15px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 3px 6px rgba(0,0,0,0.6);
        }

        .movie-status.thuyetminh {
            background: #ffd700;
            color: #000;
        }

        .movie-status.viet {
            background: #000;
            color: #fff;
        }

        .movie-episodes {
            position: absolute;
            bottom: 15px;
            left: 15px;
            background: rgba(0,0,0,0.9);
            padding: 8px 15px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: bold;
        }

        .pagination {
            display: flex;
            justify-content: center;
            margin: 40px 0;
        }

        .pagination button {
            background: #e50914;
            color: #fff;
            border: none;
            padding: 12px 30px;
            margin: 0 15px;
            cursor: pointer;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
        }

        .pagination button:hover {
            background: #b20710;
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.5);
        }

        .pagination button:disabled {
            background: #333;
            cursor: not-allowed;
            transform: none;
        }

        .scroll-top {
            position: fixed;
            bottom: 40px;
            right: 40px;
            background: #e50914;
            color: #fff;
            border: none;
            padding: 15px;
            border-radius: 50%;
            cursor: pointer;
            display: none;
            font-size: 20px;
            font-weight: bold;
            box-shadow: 0 6px 12px rgba(0,0,0,0.7);
            transition: background 0.3s ease, transform 0.2s ease;
        }

        .scroll-top:hover {
            background: #b20710;
            transform: scale(1.1);
        }

        .scroll-top.show {
            display: block;
        }

        .error-message {
            text-align: center;
            color: #e50914;
            margin: 30px 0;
            font-size: 20px;
            font-weight: bold;
            animation: fadeIn 0.5s ease;
        }

        @media (max-width: 720px) {
            .movie-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .banner {
                height: 320px;
            }

            .banner-info {
                left: 15px;
                bottom: 15px;
            }

            .banner-info h2 {
                font-size: 24px;
            }

            .search-bar input {
                width: 150px;
                font-size: 12px;
            }

            .search-bar input:focus {
                width: 180px;
            }

            .dropdown-btn {
                padding: 8px 15px;
                font-size: 12px;
            }

            .movie-item img {
                height: 200px;
            }

            .header {
                padding: 10px 15px;
            }

            .logo {
                font-size: 22px;
            }

            .nav-left, .nav-right {
                gap: 8px;
            }

            .notification img {
                width: 28px;
                height: 28px;
            }

            .container {
                padding: 20px;
            }

            .section-title {
                font-size: 22px;
            }

            .scroll-top {
                bottom: 20px;
                right: 20px;
                padding: 12px;
            }

            .movie-overlay span {
                font-size: 14px;
            }

            .movie-overlay .play-btn {
                padding: 6px 12px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="nav-left">
            <div class="logo">B√°nh M√¨ 02</div>
            <div class="dropdown">
                <button class="dropdown-btn">Phim B·ªô</button>
                <div class="dropdown-content">
                    <a href="#" data-type="phim-bo">Phim B·ªô</a>
                </div>
            </div>
            <div class="dropdown">
                <button class="dropdown-btn">Phim L·∫ª</button>
                <div class="dropdown-content">
                    <a href="#" data-type="phim-le">Phim L·∫ª</a>
                </div>
            </div>
            <div class="dropdown">
                <button class="dropdown-btn">Th·ªÉ lo·∫°i</button>
                <div class="dropdown-content">
                    <a href="#" data-type="the-loai" data-value="hanh-dong" data-label="H√†nh ƒê·ªông">H√†nh ƒê·ªông</a>
                    <a href="#" data-type="the-loai" data-value="phieu-luu" data-label="Phi√™u L∆∞u">Phi√™u L∆∞u</a>
                    <a href="#" data-type="the-loai" data-value="tre-em" data-label="Ho·∫°t H√¨nh">Ho·∫°t H√¨nh</a>
                    <a href="#" data-type="the-loai" data-value="hai" data-label="H√†i">H√†i</a>
                    <a href="#" data-type="the-loai" data-value="hinh-su" data-label="H√¨nh S·ª±">H√¨nh S·ª±</a>
                    <a href="#" data-type="the-loai" data-value="tai-lieu" data-label="T√†i Li·ªáu">T√†i Li·ªáu</a>
                    <a href="#" data-type="the-loai" data-value="chinh-kich" data-label="Ch√≠nh K·ªãch">Ch√≠nh K·ªãch</a>
                    <a href="#" data-type="the-loai" data-value="gia-dinh" data-label="Gia ƒê√¨nh">Gia ƒê√¨nh</a>
                    <a href="#" data-type="the-loai" data-value="gia-tuong" data-label="Gi·∫£ T∆∞·ªüng">Gi·∫£ T∆∞·ªüng</a>
                    <a href="#" data-type="the-loai" data-value="lich-su" data-label="L·ªãch S·ª≠">L·ªãch S·ª≠</a>
                    <a href="#" data-type="the-loai" data-value="kinh-di" data-label="Kinh D·ªã">Kinh D·ªã</a>
                    <a href="#" data-type="the-loai" data-value="nhac" data-label="Nh·∫°c">Nh·∫°c</a>
                    <a href="#" data-type="the-loai" data-value="bi-an" data-label="B√≠ ·∫®n">B√≠ ·∫®n</a>
                    <a href="#" data-type="the-loai" data-value="lang-man" data-label="L√£ng M·∫°n">L√£ng M·∫°n</a>
                    <a href="#" data-type="the-loai" data-value="khoa-hoc-vien-tuong" data-label="Khoa H·ªçc Vi·ªÖn T∆∞·ªüng">Khoa H·ªçc Vi·ªÖn T∆∞·ªüng</a>
                    <a href="#" data-type="the-loai" data-value="gay-can" data-label="G√¢y C·∫•n">G√¢y C·∫•n</a>
                    <a href="#" data-type="the-loai" data-value="chien-tranh" data-label="Chi·∫øn Tranh">Chi·∫øn Tranh</a>
                    <a href="#" data-type="the-loai" data-value="tam-ly" data-label="T√¢m L√Ω">T√¢m L√Ω</a>
                    <a href="#" data-type="the-loai" data-value="tinh-cam" data-label="T√¨nh C·∫£m">T√¨nh C·∫£m</a>
                    <a href="#" data-type="the-loai" data-value="co-trang" data-label="C·ªï Trang">C·ªï Trang</a>
                    <a href="#" data-type="the-loai" data-value="mien-tay" data-label="Mi·ªÅn T√¢y">Mi·ªÅn T√¢y</a>
                    <a href="#" data-type="the-loai" data-value="phim-18" data-label="Phim 18+">Phim 18+</a>
                </div>
            </div>
            <div class="dropdown">
                <button class="dropdown-btn">Qu·ªëc gia</button>
                <div class="dropdown-content">
                    <a href="#" data-type="quoc-gia" data-value="au-my" data-label="√Çu M·ªπ">√Çu M·ªπ</a>
                    <a href="#" data-type="quoc-gia" data-value="anh" data-label="Anh">Anh</a>
                    <a href="#" data-type="quoc-gia" data-value="trung-quoc" data-label="Trung Qu·ªëc">Trung Qu·ªëc</a>
                    <a href="#" data-type="quoc-gia" data-value="indonesia" data-label="Indonesia">Indonesia</a>
                    <a href="#" data-type="quoc-gia" data-value="viet-nam" data-label="Vi·ªát Nam">Vi·ªát Nam</a>
                    <a href="#" data-type="quoc-gia" data-value="phap" data-label="Ph√°p">Ph√°p</a>
                    <a href="#" data-type="quoc-gia" data-value="hong-kong" data-label="H·ªìng K√¥ng">H·ªìng K√¥ng</a>
                    <a href="#" data-type="quoc-gia" data-value="han-quoc" data-label="H√†n Qu·ªëc">H√†n Qu·ªëc</a>
                    <a href="#" data-type="quoc-gia" data-value="nhat-ban" data-label="Nh·∫≠t B·∫£n">Nh·∫≠t B·∫£n</a>
                    <a href="#" data-type="quoc-gia" data-value="thai-lan" data-label="Th√°i Lan">Th√°i Lan</a>
                    <a href="#" data-type="quoc-gia" data-value="dai-loan" data-label="ƒê√†i Loan">ƒê√†i Loan</a>
                    <a href="#" data-type="quoc-gia" data-value="nga" data-label="Nga">Nga</a>
                    <a href="#" data-type="quoc-gia" data-value="ha-lan" data-label="H√† Lan">H√† Lan</a>
                    <a href="#" data-type="quoc-gia" data-value="philippines" data-label="Philippines">Philippines</a>
                    <a href="#" data-type="quoc-gia" data-value="an-do" data-label="·∫§n ƒê·ªô">·∫§n ƒê·ªô</a>
                    <a href="#" data-type="quoc-gia" data-value="quoc-gia-khac" data-label="Qu·ªëc gia kh√°c">Qu·ªëc gia kh√°c</a>
                </div>
            </div>
            <div class="dropdown">
                <button class="dropdown-btn">NƒÉm</button>
                <div class="dropdown-content">
                    <script>
                        for (let year = 2029; year >= 1999; year--) {
                            document.write(`<a href="#" data-type="nam" data-value="${year}" data-label="${year}">${year}</a>`);
                        }
                    </script>
                </div>
            </div>
        </div>
        <div class="nav-right">
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="T√¨m phim...">
            </div>
            <div class="notification">
                <img src="https://img.icons8.com/ios-filled/50/ffffff/bell.png" alt="Th√¥ng b√°o">
            </div>
        </div>
    </div>

    <div class="banner" id="banner">
        <img id="bannerImage" src="https://via.placeholder.com/1600x600?text=Banner" alt="Banner">
        <div class="banner-info">
            <h2 id="bannerTitle"></h2>
        </div>
    </div>

    <div class="container">
        <div class="section">
            <h2 class="section-title" id="mainSectionTitle">Phim M·ªõi C·∫≠p Nh·∫≠t</h2>
            <div class="movie-grid" id="newMovies"></div>
            <div class="pagination">
                <button onclick="prevPage('newMovies')">Tr∆∞·ªõc</button>
                <button onclick="nextPage('newMovies')">Sau</button>
            </div>
        </div>

        <div class="section">
            <h2 class="section-title">Phim ƒêang Chi·∫øu</h2>
            <div class="movie-grid" id="nowPlaying"></div>
            <div class="pagination">
                <button onclick="prevPage('nowPlaying')">Tr∆∞·ªõc</button>
                <button onclick="nextPage('nowPlaying')">Sau</button>
            </div>
        </div>
    </div>

    <button class="scroll-top" onclick="scrollToTop()">‚Üë</button>

    <script>
        let newMoviesPage = 1;
        let nowPlayingPage = 1;
        let currentFilter = { type: '', value: '', label: '' };
        const baseUrl = 'https://phimapi.com';
        let moviesCache = {};

        // Chuy·ªÉn poster_url sang full URL
        function getFullImageUrl(url) {
            if (!url) return 'https://via.placeholder.com/300x450?text=No+Image';
            if (url.startsWith('http')) return url;
            return `https://phimimg.com/${url.replace(/^\/+/, '')}`;
        }

        // Fetch movies t·ª´ API
        async function fetchMovies(section, type = '', page = 1, filterType = '', filterValue = '') {
            const cacheKey = `${section}-${filterType}-${filterValue}-page${page}`;
            if (moviesCache[cacheKey]) {
                displayMovies(section, moviesCache[cacheKey]);
                return;
            }

            let url;
            if (section === 'nowPlaying') {
                url = `${baseUrl}/danh-sach/phim-moi-cap-nhat-v3?page=${page}`;
            } else if (filterType === 'phim-bo') {
                url = `${baseUrl}/v1/api/danh-sach/phim-bo?page=${page}`;
            } else if (filterType === 'phim-le') {
                url = `${baseUrl}/v1/api/danh-sach/phim-le?page=${page}`;
            } else if (filterType === 'the-loai') {
                url = `${baseUrl}/v1/api/the-loai/${filterValue}?page=${page}`;
            } else if (filterType === 'quoc-gia') {
                url = `${baseUrl}/v1/api/quoc-gia/${filterValue}?page=${page}`;
            } else if (filterType === 'nam') {
                url = `${baseUrl}/v1/api/nam/${filterValue}?page=${page}`;
            } else {
                url = `${baseUrl}/danh-sach/phim-moi-cap-nhat?page=${page}`;
            }

            try {
                const response = await fetch(url, { headers: { 'Accept': 'application/json' } });
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);

                const data = await response.json();
                let movies = (data.data && data.data.items) ? data.data.items : (data.items || []);

                // N·∫øu √≠t h∆°n 14 phim, fetch th√™m c√°c page k·∫ø ti·∫øp
                let nextPage = page + 1;
                while (movies.length < 14 && nextPage <= page + 4) {
                    const nextUrl = url.replace(`page=${page}`, `page=${nextPage}`);
                    const nextResp = await fetch(nextUrl, { headers: { 'Accept': 'application/json' } });
                    if (nextResp.ok) {
                        const nextData = await nextResp.json();
                        const nextMovies = (nextData.data && nextData.data.items) ? nextData.data.items : (nextData.items || []);
                        movies = [...movies, ...nextMovies].slice(0, 14);
                    }
                    nextPage++;
                }

                moviesCache[cacheKey] = movies;
                displayMovies(section, movies);
            } catch (err) {
                console.error('Error fetching movies:', err);
                const container = document.getElementById(section);
                container.innerHTML = `<div class="error-message">Kh√¥ng th·ªÉ t·∫£i danh s√°ch phim. L·ªói: ${err.message}</div>`;
            }
        }

        // Hi·ªÉn th·ªã movies
        function displayMovies(section, movies) {
            const container = document.getElementById(section);
            container.innerHTML = '';

            if (!movies || movies.length === 0) {
                container.innerHTML = '<div class="error-message">Kh√¥ng t√¨m th·∫•y phim!</div>';
                return;
            }

            movies.forEach(movie => {
                if (!movie || !movie.name || !movie.slug) return;

                const poster = getFullImageUrl(movie.poster_url);
                const lang = movie.lang || 'Vietsub';
                const langClass = lang.toLowerCase().includes('thuy·∫øt minh') || lang.toLowerCase().includes('l·ªìng ti·∫øng') ? 'thuyetminh' : 'viet';

                let currentEpisode = movie.episode_current || 'N/A';
                let totalEpisodes = movie.episode_total || 'N/A';

                const match = currentEpisode.match(/(\d+)\/(\d+)/);
                if (match) {
                    currentEpisode = match[1];
                    totalEpisodes = match[2];
                }

                const div = document.createElement('div');
                div.className = 'movie-item';
                div.innerHTML = `
                    <img src="${poster}" alt="${movie.name}" loading="lazy">
                    <div class="movie-overlay">
                        <span>${movie.name}</span>
                        <div class="play-btn">Xem ngay</div>
                    </div>
                    <div class="movie-status ${langClass}">${lang}</div>
                    <div class="movie-episodes">${currentEpisode}${totalEpisodes !== 'N/A' ? '/' + totalEpisodes : ''}</div>
                `;
                // Th√™m event listener ƒë·ªÉ tr√°nh click nh·∫ßm
                div.addEventListener('click', () => window.location.href = `detail.html?slug=${movie.slug}`);
                div.addEventListener('touchstart', (e) => {
                    e.preventDefault(); // NgƒÉn h√†nh vi m·∫∑c ƒë·ªãnh khi ch·∫°m
                    const touch = e.touches[0];
                    div.dataset.startX = touch.clientX;
                    div.dataset.startY = touch.clientY;
                });
                div.addEventListener('touchmove', (e) => {
                    const touch = e.touches[0];
                    const deltaX = Math.abs(touch.clientX - div.dataset.startX);
                    const deltaY = Math.abs(touch.clientY - div.dataset.startY);
                    if (deltaX > 10 || deltaY > 10) {
                        e.preventDefault(); // NgƒÉn click khi vu·ªët
                    }
                });
                div.addEventListener('touchend', (e) => {
                    const touch = e.changedTouches[0];
                    const deltaX = Math.abs(touch.clientX - div.dataset.startX);
                    const deltaY = Math.abs(touch.clientY - div.dataset.startY);
                    if (deltaX < 10 && deltaY < 10) {
                        window.location.href = `detail.html?slug=${movie.slug}`;
                    }
                });
                container.appendChild(div);
            });
        }

        // Fetch banner
        async function fetchBanner() {
            try {
                const response = await fetch(`${baseUrl}/danh-sach/phim-moi-cap-nhat-v3?page=1`, { headers: { 'Accept': 'application/json' } });
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);

                const data = await response.json();
                const movies = (data.data && data.data.items) ? data.data.items : (data.items || []);
                if (movies.length === 0) return;

                const randomMovie = movies[Math.floor(Math.random() * Math.min(movies.length, 5))];
                if (!randomMovie) return;

                document.getElementById('bannerImage').src = getFullImageUrl(randomMovie.thumb_url);
                document.getElementById('bannerTitle').textContent = randomMovie.name || '';
            } catch (err) {
                console.error('Error fetching banner:', err);
            }
        }

        // Search movie b·∫±ng slug
        async function searchSingleMovie(slug) {
            try {
                const response = await fetch(`${baseUrl}/phim/${slug}`, { headers: { 'Accept': 'application/json' } });
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);

                const data = await response.json();
                const movie = data.movie || data.film;
                if (movie && movie.name && movie.slug) return [movie];
                return [];
            } catch (err) {
                console.error('Error searching single movie:', err);
                return [];
            }
        }

        // Pagination
        function prevPage(section) {
            if (section === 'newMovies' && newMoviesPage > 1) {
                newMoviesPage--;
                fetchMovies(section, '', newMoviesPage, currentFilter.type, currentFilter.value);
            } else if (section === 'nowPlaying' && nowPlayingPage > 1) {
                nowPlayingPage--;
                fetchMovies(section, '', nowPlayingPage);
            }
        }

        function nextPage(section) {
            if (section === 'newMovies') {
                newMoviesPage++;
                fetchMovies(section, '', newMoviesPage, currentFilter.type, currentFilter.value);
            } else if (section === 'nowPlaying') {
                nowPlayingPage++;
                fetchMovies(section, '', nowPlayingPage);
            }
        }

        // Scroll top
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Event listeners
        document.getElementById('searchInput').addEventListener('input', async function(e) {
            const query = e.target.value.toLowerCase().replace(/[^a-z0-9-]/g, '').replace(/\s+/g, '-').trim();
            if (!query) {
                currentFilter = { type: '', value: '', label: '' };
                document.getElementById('mainSectionTitle').textContent = 'Phim M·ªõi C·∫≠p Nh·∫≠t';
                fetchMovies('newMovies', 'phim-moi-cap-nhat', 1);
                return;
            }

            currentFilter = { type: '', value: '', label: '' };
            document.getElementById('mainSectionTitle').textContent = 'K·∫øt Qu·∫£ T√¨m Ki·∫øm';
            const movies = await searchSingleMovie(query);
            displayMovies('newMovies', movies.length ? movies : []);
        });

        document.getElementById('searchInput').addEventListener('keypress', async function(e) {
            if (e.key === 'Enter') e.target.dispatchEvent(new Event('input'));
        });

        // Dropdown filter
        document.querySelector('.nav-left').addEventListener('click', function(e) {
            if (e.target.tagName !== 'A') return;
            e.preventDefault();

            const type = e.target.dataset.type;
            const value = e.target.dataset.value;
            const label = e.target.dataset.label || e.target.textContent.trim();

            currentFilter = { type, value, label };
            document.getElementById('mainSectionTitle').textContent = label;
            newMoviesPage = 1;
            fetchMovies('newMovies', '', 1, type, value);
            scrollToTop();
        });

        // Header scroll & scroll-top button
        window.addEventListener('scroll', () => {
            document.querySelector('.scroll-top').classList.toggle('show', window.scrollY > 300);
            document.querySelector('.header').classList.toggle('scrolled', window.scrollY > 50);
        });

        // Init
        setInterval(fetchBanner, 10000);
        fetchMovies('newMovies', 'phim-moi-cap-nhat', 1);
        fetchMovies('nowPlaying', '', 1);
        fetchBanner();
    </script>
</body>
</html>